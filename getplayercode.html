<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>WRT 2015 - Get Player Code</title>
		<meta name="viewport" content="initial-scale=1, maximum-scale=1">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="css/ratchet.min.css">
		<link rel="stylesheet" href="css/app.css">
		<script src="js/ratchet.min.js"></script>
		<script src="js/jquery-1.11.1.min.js"></script>
		<script src="js/jquery.blockUI.js"></script>		
		<script src="js/jquery.cookie.js"></script>
		<script src="js/jquery.storageapi.min.js"></script>
		<script src="js/jquery.serialize-object.min.js"></script>
		<script src="js/tmpl.min.js"></script>
		<script src="js/notify.min.js"></script>
		<script src="js/notify.bootstrap.js"></script>
		<script src="js/html5-qrcode.min.js"></script>
		<script src="js/html5-qrcode.js"></script>
		<script src="js/app.js"></script>
		<script type="text/x-tmpl" id="tmpl-playerlist">
		  <li class="table-view-cell">
			<a class="navigate-right" data-ignore="push" href="players.html#{%=o.card_no%}">
			  <img class="media-object pull-left img-responsive" style="width:15%" src="{%=o.pic_url%}">
			  <div class="media-body">
				{%=o.full_name%}
				<p>{%=o.card_no%}</p>
			  </div>
			</a>
		   </li>
		</script>		
	</head>
	<body id="getplayer">
		<header class="bar bar-nav col-xs-12">
			<a  href="home.html" class="icon icon-home pull-left" data-ignore="push"></a>
			<h1 class="title">FIND PLAYER</h1>
		</header>
		<div class="content content-padded">
			<div class="segmented-control">
				<a class="control-item active" href="#byscan">QRCODE</a>
				<a class="control-item" href="#bycode">BY CODE</a>
				<a class="control-item" href="#byname">BY NAME</a>
			</div>
			<div class="card">
				<div id="byscan" class="control-content active">
					<div class="table-view-cell">
						<div id="reader" style="width:100%;height:75%;min-height:300px;">
						</div>
						<button type="button" class="start btn-primary">SCAN CARD</button>
					</div>
				</div>
				<div id="bycode" class="control-content">
					<div class="table-view-cell">
						<input type='text' id='playercode' style="height: 25px;width: 80%;top: 30%;" placeholder='Type a card number'/>
					</div>
					<div>
						<button type="button" class="start submit btn btn-primary">FIND</button>
					</div>
				</div>
				<div id="byname" class="control-content">
					<div class="table-view-cell">
						<input type='text' id='anything' style="height: 25px;width: 80%;top: 30%;" placeholder='Type any player information'/>
					</div>
					<button type="button" class="start submit btn btn-primary">FIND</button>
				</div>
			</div>
		</div>
			
		<!-- /.content -->
		<div id="playerlist" class="modal">
		  <header class="bar bar-nav">
		    <a class="icon icon-close pull-right" href="#playerlist"></a>
		    <h1 class="title">Search Results</h1>
		  </header>
		  <div class="content content-padded">
			  <ul id="searchresults" class="table-view">
			  </ul>
		  </div>
	    </div>		
	</body>
	<script>
		$(function() {
			$("#saverecord").on("touchstart",function(){
				d = {player:{
					id: $("#playercode").val(), 
					active: $("#activate").val()
				}, player_details:{
					hotel_card:$("#hotel_card").val(), 
					room_no: $("#room_no").val()
				}};
				
				$.post( ConfigApi().URL_PLAYERUPDATE , d )
					.done(function(r) {
						if(r.status == 200) {
							$.notify("Player activated successfully", "success");
						} else if(r.status == 500) {
							$.notify('server error', 'error');
						} else {
							$.notify('player information not found', 'warning');
						}
						
						$("#editplayer").removeClass('active');
					});
			});
					
			$("#bycode button.start").on("touchstart",function(){
				txt = $("#playercode").val();
				if(txt == '') {
					$.notify("Enter part of code to search", "error");
					return;
				}
				$("#searchresults").html("<li>please wait...</li>");
				$("#playerlist").addClass("active");
				$.post( ConfigApi().URL_PLAYERFIND , {search_type: 'code', search: txt } )
				.done(function(r) {
					$("#searchresults").html("");
					if(r.status == 200) {
						$.each(r.data, function(i,d) {
							$("#searchresults").append(tmpl('tmpl-playerlist', d));
						});
					} else{
						$("#searchresults").html(r.data);
					}
				});
			});
			
			$("#byname button.start").on("touchstart",function(){
				txt = $("#anything").val();
				if(txt == '') {
					$.notify("Enter a name to search", "error");
					return;
				}
				$("#searchresults").html("<li>please wait...</li>");
				$("#playerlist").addClass("active");
				$.post( ConfigApi().URL_PLAYERFIND , {search_type: 'any', search: txt } )
				.done(function(r) {
					$("#searchresults").html("");
					if(r.status == 200) {
						$.each(r.data, function(i,d) {
							$("#searchresults").append(tmpl('tmpl-playerlist', d));
						});
					} else{
						$("#searchresults").html(r.data);
					}
				});
			});
			
			$("#byscan button.start").on("touchstart",function(){
				/*var id = $("#playercode").val();
				if(id =='') {
					$.notify("Enter player code", "error");
					return;
				}
				$.post( ConfigApi().URL_PLAYERINFO , {id: id} )
				.done(function(r) {
					if(r.status == 200) {
						$("#playerinfo").html(tmpl('tmpl-playerinfo', r.data));
					} else if(r.status == 500) {
						$("#playerinfo").html('server error');
					} else {
						$("#playerinfo").html('player information not found');
					}
				});
				*/

				$('#reader').html5_qrcode(function(data){
						// do something when code is read
						//this.stop();
						$("#searchresults").html("<li>please wait...</li>");
						$("#playerlist").addClass("active");
						$.post( ConfigApi().URL_PLAYERFIND , {search_type: 'code', search: txt } )
						.done(function(r) {
							$("#searchresults").html("");
							if(r.status == 200) {
								$.each(r.data, function(i,d) {
									$("#searchresults").append(tmpl('tmpl-playerlist', d));
								});
							} else{
								$("#searchresults").html(r.data);
							}
						});
					},
					function(error){
						//show read errors 
						//this.stop();
						//alert(error);
						//$.notify('Reader Error', 'error');
					}, function(videoError){
						//the video stream could be opened
						//this.stop();
						$.notify('Video Error', 'error');
					}
				);
			});
		
		});
	</script>
</html>
